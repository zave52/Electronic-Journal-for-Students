<div class="gradebook-container p-6">
  <h2 class="text-2xl font-bold mb-6">Gradebook</h2>

  <div *ngIf="loading" class="loading-state text-center py-8">
    <p class="text-gray-600">Loading gradebook...</p>
  </div>

  <div *ngIf="error" class="error-state text-red-600 text-center py-8">
    <p>{{ error }}</p>
  </div>

  <div *ngIf="!loading && !error" class="gradebook-content">
    <div *ngIf="students.length === 0 || assignments.length === 0" class="empty-state text-center py-8">
      <p class="text-gray-600">
        <span *ngIf="students.length === 0">No students enrolled in this course.</span>
        <span *ngIf="students.length > 0 && assignments.length === 0">No assignments created yet.</span>
      </p>
    </div>

    <div *ngIf="students.length > 0 && assignments.length > 0" class="overflow-x-auto shadow-md rounded-lg">
      <table class="min-w-full bg-white border-collapse">
        <thead class="bg-gray-100 sticky top-0">
        <tr>
          <th
            class="px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b-2 border-gray-300 sticky left-0 bg-gray-100 z-10">
            Student Name
          </th>
          <th *ngFor="let assignment of assignments"
              class="px-4 py-3 text-center text-sm font-semibold text-gray-700 border-b-2 border-gray-300 min-w-[120px]">
            <div class="flex flex-col">
              <span class="font-semibold">{{ assignment.title }}</span>
              <span class="text-xs text-gray-500 font-normal mt-1">
                  Avg: {{ getAverageForAssignment(assignment.id) ?? 'â€”' }}%
                </span>
            </div>
          </th>
          <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700 border-b-2 border-gray-300 bg-blue-50">
            Average
          </th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let student of students; let i = index"
            [class.bg-gray-50]="i % 2 === 0"
            class="hover:bg-blue-50 transition-colors">
          <td class="px-4 py-3 text-sm font-medium text-gray-900 border-b border-gray-200 sticky left-0 z-10"
              [class.bg-gray-50]="i % 2 === 0"
              [class.bg-white]="i % 2 === 1">
            {{ student.name }}
          </td>
          <td *ngFor="let assignment of assignments"
              class="px-4 py-3 text-center border-b border-gray-200 relative">
            <input
              type="number"
              min="0"
              max="100"
              [value]="getGradeCell(student.id, assignment.id)?.grade ?? ''"
              (input)="onGradeChange(student.id, assignment.id, $any($event.target).value)"
              (blur)="onGradeBlur(student.id, assignment.id)"
              [disabled]="isSaving(student.id, assignment.id)"
              class="w-full px-2 py-1 text-center border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100"
              [class.border-gray-300]="!getGradeCell(student.id, assignment.id)?.grade"
              [class.border-green-500]="getGradeCell(student.id, assignment.id)?.grade! >= 90"
              [class.border-blue-500]="getGradeCell(student.id, assignment.id)?.grade! >= 75 && getGradeCell(student.id, assignment.id)?.grade! < 90"
              [class.border-yellow-500]="getGradeCell(student.id, assignment.id)?.grade! >= 60 && getGradeCell(student.id, assignment.id)?.grade! < 75"
              [class.border-red-500]="getGradeCell(student.id, assignment.id)?.grade! < 60"
              placeholder="â€”"
            />
            <span *ngIf="isSaving(student.id, assignment.id)"
                  class="absolute right-2 top-1/2 transform -translate-y-1/2 text-blue-500 text-xs">
                ðŸ’¾
              </span>
          </td>
          <td class="px-4 py-3 text-center border-b border-gray-200 font-semibold bg-blue-50">
              <span [class.text-green-700]="getAverageForStudent(student.id)! >= 90"
                    [class.text-blue-700]="getAverageForStudent(student.id)! >= 75 && getAverageForStudent(student.id)! < 90"
                    [class.text-yellow-700]="getAverageForStudent(student.id)! >= 60 && getAverageForStudent(student.id)! < 75"
                    [class.text-red-700]="getAverageForStudent(student.id)! < 60"
                    [class.text-gray-500]="getAverageForStudent(student.id) === null">
                {{ getAverageForStudent(student.id) ?? 'â€”' }}%
              </span>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="mt-6 p-4 bg-blue-50 rounded-lg">
      <h3 class="text-sm font-semibold text-gray-700 mb-2">Grading Instructions:</h3>
      <ul class="text-sm text-gray-600 space-y-1">
        <li>â€¢ Enter grades from 0 to 100</li>
        <li>â€¢ Grades are saved automatically when you leave the field</li>
        <li>â€¢ Leave empty to remove a grade</li>
        <li>â€¢ Color coding: <span class="text-green-700 font-semibold">90-100</span>,
          <span class="text-blue-700 font-semibold">75-89</span>,
          <span class="text-yellow-700 font-semibold">60-74</span>,
          <span class="text-red-700 font-semibold">&lt;60</span>
        </li>
      </ul>
    </div>
  </div>
</div>

